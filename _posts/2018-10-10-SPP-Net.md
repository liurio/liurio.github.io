既然CNN的特征提取过程如此耗时(大量的卷积计算)，为什么要对每个候选区域独立计算，而不是提取整体特征，仅在分类前做一次Region截取呢？SPP-Net就是改进了这个工作.....

### 原理介绍
![image](https://raw.githubusercontent.com/liurio/deep_learning/master/img/SPP-Net%E5%8E%9F%E7%90%86.png)

SPP-Net在RCNN的基础上做了以下**实质性改**进：
- 取消了crop/wrap的图像归一化过程，解决变形图像导致的信息丢失以及存储问题；
- 采用**空间金字塔池化**替换了 全连接层fc之前的最后一个池化层，上图中的**pool5**。

为了适应不同分辨率的特征图，定义一种**可以伸缩的池化层**，不管输入的分辨率多大，都可以划分成`m*n`个部分。这是SPP-Net显著特征之一，它的输入是**conv5特征图**以及**特征图候选框**，输出是固定尺寸`m*n`特征。

还有金字塔呢？通过多尺度增加所提取特征的鲁棒性，这并不关键，在后续**Fast RCNN**中该特征已被舍弃。

**最关键的是SPP的位置，它放在所有卷积层之后，有效解决了卷积层的重复计算问题(速度提高数倍)，这是核心关键所在。**

![image](https://raw.githubusercontent.com/liurio/deep_learning/master/img/SPP-Net网络结构.png)

### 目标检测步骤：
- **区域提名**：用Selective Search从原图中生成2000个左右的候选窗口；
- **区域大小缩放**：SPP-Net不再做区域大小归一化，而是标准缩放到`min(w,h)=s`, 即统一长宽的最短边长度，s选自`(480,576,688,864,1200)`中的一个，选择的标准是缩放后的候选框大小与`224*224`接近；
- **特征提取**：利用SPP-Net网络提取特征；
- **分类与回归**：类似R-CNN，利用SVM基于上面的特征训练分类器模型，用边框回归来调整候选框的位置；

### SPP-Net存在的问题
- 和R-CNN一样，训练过程是分离的，提取候选框 - 计算CNN特征 - SVM分类 - Bounding Box回归独立训练，大量的中间结果需要转存，无法训练整体参数。
- SPP-Net无法同时微调在SPP-Layer两边的卷积层和全连接层；
- 整个过程中PR仍然很耗时